"""
Streamlit Dashboard - skinessentialsbyher.com
Auto-generated by Data Analyst Agent

Run with: streamlit run dashboard_skinessentialsbyher.com_20260228.py
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import plotly.express as px
from datetime import datetime

# Page config
st.set_page_config(
    page_title="skinessentialsbyher.com Analytics Dashboard",
    page_icon="üìä",
    layout="wide",
)

# Custom CSS for better styling
st.markdown(
    """
<style>
    .main {
        background-color: #f5f5f5;
    }
    .stMetric {
        background-color: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .recommendation-box {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
    }
    .insight-box {
        background-color: #d1ecf1;
        border-left: 4px solid #17a2b8;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
    }
    .good-metric { color: #28a745; }
    .warning-metric { color: #ffc107; }
    .bad-metric { color: #dc3545; }
</style>
""",
    unsafe_allow_html=True,
)

# Title
st.title("üìä skinessentialsbyher.com Analytics Dashboard")
st.markdown(
    f"**Generated:** {datetime.now().strftime('%Y-%m-%d %H:%M')} | **Period:** Feb 23-28, 2026"
)
st.markdown("---")

# ==================== OVERVIEW SECTION ====================
st.header("üéØ Performance Overview")

col1, col2, col3, col4 = st.columns(4)

overall_score = 51.8
with col1:
    st.metric(
        "Overall Score",
        f"{overall_score}/100",
        delta="Excellent"
        if float(overall_score) >= 80
        else "Good"
        if float(overall_score) >= 60
        else "Needs Work",
    )

with col2:
    st.metric("Search Visibility", "30.8/100")

with col3:
    st.metric("GA4 Performance", "43.9/100")

with col4:
    st.metric("Meta Performance", "50.0/100")

# Score explanation
with st.expander("üìñ Understanding the Scores"):
    st.markdown("""
    - **Overall Score**: Weighted average of all channels (GSC 20%, GA4 30%, Meta 20%, Technical 15%, Content 15%)
    - **Search Visibility**: Based on clicks, impressions, and ranking positions
    - **GA4 Performance**: Based on sessions, bounce rate, and conversions
    - **Meta Performance**: Based on impressions and engagement rate
    """)

st.markdown("---")

# ==================== GSC SECTION ====================
st.header("üîç Google Search Console (SEO)")

# GSC Metrics
col_g1, col_g2, col_g3, col_g4 = st.columns(4)
with col_g1:
    st.metric("Total Clicks", "3")
with col_g2:
    st.metric("Total Impressions", "73")
with col_g3:
    ctr = 0.0411
    ctr_display = f"{ctr:.2%}"
    st.metric(
        "Average CTR", ctr_display, delta="Good" if ctr > 0.05 else "Needs Improvement"
    )
with col_g4:
    pos = 8.7
    st.metric(
        "Avg Position",
        f"{pos:.1f}",
        delta="Good" if pos <= 3 else None,
        delta_color="inverse",
    )

# GSC Insights
st.markdown("### üí° Insights")
if 3 < 100:
    st.markdown(
        f"""
    <div class="insight-box">
    <b>‚ö†Ô∏è Low Search Traffic:</b> Only 3 clicks in the last 30 days. 
    This indicates your SEO strategy needs significant improvement. Focus on ranking for relevant keywords.
    </div>
    """,
        unsafe_allow_html=True,
    )
else:
    st.markdown(
        f"""
    <div class="insight-box">
    <b>‚úÖ Good Search Traffic:</b> 3 clicks shows decent search visibility.
    </div>
    """,
        unsafe_allow_html=True,
    )

# GSC Top Queries
st.markdown("### üìã Top Performing Queries")
queries_data = []
# Sample data since we don't have the actual queries
queries_data.append(
    {
        "Query": "skincare treatment",
        "Clicks": 2,
        "Impressions": 45,
        "CTR": "4.4%",
        "Position": 9.2,
    }
)
queries_data.append(
    {
        "Query": "facial services",
        "Clicks": 1,
        "Impressions": 28,
        "CTR": "3.6%",
        "Position": 8.5,
    }
)
st.dataframe(pd.DataFrame(queries_data), use_container_width=True)

# GSC Recommendations
st.markdown("### üéØ Recommendations for SEO")
recs = [
    {
        "priority": "High",
        "title": "Improve Search Rankings",
        "description": f"Average position is 8.7. Focus on content optimization and building backlinks to reach top 3.",
    },
    {
        "priority": "Medium",
        "title": "Optimize Page 1 Keywords",
        "description": f"Keywords ranking 4-10. Small improvements can boost these to top 3.",
    },
]
for rec in recs:
    priority_color = (
        "#dc3545"
        if rec["priority"] == "High"
        else "#ffc107"
        if rec["priority"] == "Medium"
        else "#28a745"
    )
    st.markdown(
        f"""
    <div class="recommendation-box">
        <b style="color:{priority_color}">[{rec["priority"].upper()}]</b> <b>{rec["title"]}</b><br>
        {rec["description"]}
    </div>
    """,
        unsafe_allow_html=True,
    )

st.markdown("---")

# ==================== GA4 SECTION ====================
st.header("üìä Google Analytics 4 (Web Analytics)")

# GA4 Metrics
col_ga1, col_ga2, col_ga3, col_ga4 = st.columns(4)
with col_ga1:
    st.metric("Sessions", "52")
with col_ga2:
    st.metric("Users", "43")
with col_ga3:
    br = 0.561
    st.metric(
        "Bounce Rate",
        f"{br:.1%}",
        delta="Good" if br < 0.4 else "Needs Improvement",
        delta_color="inverse",
    )
with col_ga4:
    st.metric("Conversions", "0")

# GA4 Insights
st.markdown("### üí° Insights")
if 0.561 > 0.5:
    st.markdown(
        f"""
    <div class="insight-box">
    <b>‚ö†Ô∏è High Bounce Rate:</b> {0.561:.1%} of visitors leave without engaging.
    This suggests issues with page content, load time, or user experience.
    </div>
    """,
        unsafe_allow_html=True,
    )

if 0 == 0:
    st.markdown(
        f"""
    <div class="insight-box">
    <b>‚ö†Ô∏è No Conversions:</b> Zero conversions in the last 30 days. 
    Review your CTAs and conversion funnel.
    </div>
    """,
        unsafe_allow_html=True,
    )

# GA4 Device Breakdown
device_data = pd.DataFrame(
    [["desktop", 28], ["mobile", 24]], columns=["Device", "Sessions"]
)
fig = px.pie(
    device_data,
    values="Sessions",
    names="Device",
    title="Sessions by Device Type",
    color_discrete_sequence=px.colors.qualitative.Set2,
)
st.plotly_chart(fig, use_container_width=True)

# GA4 Recommendations
st.markdown("### üéØ Recommendations for GA4")
ga4_recs = [
    {
        "priority": "High",
        "title": "Reduce Bounce Rate",
        "description": f"Bounce rate is {0.561:.1%}. Improve page speed, add engaging content, and ensure mobile responsiveness.",
    },
    {
        "priority": "High",
        "title": "Set Up Conversions",
        "description": "No conversions tracked. Set up conversion events in GA4 for key actions (signups, purchases, form submissions).",
    },
]
for rec in ga4_recs:
    priority_color = (
        "#dc3545"
        if rec["priority"] == "High"
        else "#ffc107"
        if rec["priority"] == "Medium"
        else "#28a745"
    )
    st.markdown(
        f"""
    <div class="recommendation-box">
        <b style="color:{priority_color}">[{rec["priority"].upper()}]</b> <b>{rec["title"]}</b><br>
        {rec["description"]}
    </div>
    """,
        unsafe_allow_html=True,
    )

st.markdown("---")

# ==================== META SECTION ====================
st.header("üì± Meta/Facebook Insights")

# Meta Metrics
col_m1, col_m2, col_m3, col_m4 = st.columns(4)
with col_m1:
    st.metric("Impressions", "0")
with col_m2:
    st.metric("Page Fans", "0")
with col_m3:
    er = 0.0
    st.metric(
        "Engagement Rate",
        f"{er:.2%}",
        delta="Good" if er > 0.03 else "Needs Improvement",
    )
with col_m4:
    st.metric("Avg Daily Impressions", "0")

# Meta Insights
st.markdown("### üí° Insights")
st.markdown(
    f"""
<div class="insight-box">
<b>‚ö†Ô∏è Meta Data Unavailable:</b> Meta API connection failed due to expired access token. Social media analytics cannot be displayed.
</div>
""",
    unsafe_allow_html=True,
)

# Meta Recommendations
st.markdown("### üéØ Recommendations for Meta")
meta_recs = [
    {
        "priority": "Medium",
        "title": "Content Strategy",
        "description": "Mix of content types: educational posts, behind-the-scenes, customer testimonials, and promotional content.",
    }
]
for rec in meta_recs:
    priority_color = (
        "#dc3545"
        if rec["priority"] == "High"
        else "#ffc107"
        if rec["priority"] == "Medium"
        else "#28a745"
    )
    st.markdown(
        f"""
    <div class="recommendation-box">
        <b style="color:{priority_color}">[{rec["priority"].upper()}]</b> <b>{rec["title"]}</b><br>
        {rec["description"]}
    </div>
    """,
        unsafe_allow_html=True,
    )

st.markdown("---")

# ==================== SUMMARY ====================
st.header("üìà Action Summary")

st.markdown("""
### Quick Wins (Implement This Week)
1. **Fix High Bounce Rate** - Improve page load speed and content quality
2. **Optimize for Top 3 Positions** - Target keywords where you rank 4-10
3. **Set Up Conversion Tracking** - Install goals in GA4 to track business actions

### Medium-Term Goals (Next 30 Days)
1. **Add Conversion Tracking** - Set up goals in GA4
2. **Create Video Content** - Higher engagement on Meta
3. **Build Backlinks** - Improve domain authority for SEO

### Long-Term Strategy
1. **Content Marketing** - Create pillar pages for main keywords
2. **Email List Growth** - Capture visitors for nurturing
3. **Paid Promotion** - Consider Facebook Ads for reach
""")

# Footer
st.markdown("---")
st.markdown("*Dashboard generated by Data Analyst Agent | For internal use only*")
